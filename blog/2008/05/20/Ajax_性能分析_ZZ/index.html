
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ajax_性能分析_ZZ - ChandleWEi's Blog</title>
  <meta name="author" content="Chandler Wei">

  
  <meta name="description" content="| Ajax 性能分析 使用最新的工具分析性能 | | | | | | | 文档选项 | | 未显示需要 JavaScript 的文档选项 | | | 打印本页) | | | | 将此页作为电子邮件发送;) |
| | | 英文原文 | | | 级别： 中级 Kristopher William &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ChandleWEi.github.io/blog/2008/05/20/Ajax_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90_ZZ">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="ChandleWEi's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ChandleWEi's Blog</a></h1>
  
    <h2>Welcome to our life, Roy</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ChandleWEi.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ajax_性能分析_ZZ</h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-20T00:00:00+08:00" pubdate data-updated="true">May 20<span>th</span>, 2008</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>|</p>

<h1>Ajax 性能分析</h1>

<p><em>使用最新的工具分析性能</em></p>

<p><img src="http://www.ibm.com/i/c.gif" alt="" /> | <img src="http://www.ibm.com/developerworks/i/dw.gif" alt="developerWorks" /> |</p>

<p>| <img src="http://www.ibm.com/i/c.gif" alt="" /> |</p>

<p>| <img src="http://www.ibm.com/i/c.gif" alt="" /> |</p>

<p>| 文档选项 |</p>

<p>| <tr valign="top"><td width="8"><img alt="" height="1" width="8" src="//www.ibm.com/i/c.gif" /></td><td width="16"><img alt="" width="16" height="16" src="//www.ibm.com/i/c.gif" /></td><td class="small" width="122"><p><span class="ast">未显示需要 JavaScript 的文档选项</span></p></td></tr></p>

<p>  | <img src="http://www.ibm.com/i/c.gif" alt="" /> | <img src="http://www.ibm.com/i/v14/icons/printer.gif" alt="将打印机的版面设置成横向打印模式" /> |</p>

<p><strong> <a href="javascript:print(">打印本页</a>)</strong></p>

<p>|
  | <img src="http://www.ibm.com/i/c.gif" alt="" /> | <img src="http://www.ibm.com/i/v14/icons/em.gif" alt="将此页作为电子邮件发送" /> |</p>

<p><a href="javascript:document.email.submit("><strong>将此页作为电子邮件发送</strong></a>;)</p>

<p>|
| <img src="http://www.ibm.com/i/c.gif" alt="" /> | <img src="http://www.ibm.com/i/v14/icons/fw_bold.gif" alt="英文原文 " /> |</p>

<p><a href="http://www.ibm.com/developerworks/web/library/wa-aj-perform/"><strong>英文原文</strong></a></p>

<p>|</p>

<p>|</p>

<p>|</p>

<p>级别： 中级</p>

<p><a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#author">Kristopher William Zyp</a> ( <a href="mailto:kriszyp@xucia.com?subject=Ajax%20%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90&amp;cc=ruterbo@us.ibm.com">kriszyp@xucia.com</a>), 软件开发人员, Xucia</p>

<p>2008 年 5 月 19 日</p>

<blockquote><p>由 于 Asynchronous JavaScript + XML（Ajax）的出现，用户对交互性和性能的期望越来越高了，而开发人员也把 Ajax 视为 Web 应用程序中必需的部分。随着更多的代码转移到客户端和网络模型的改变，开发人员社区构建了更多工具来解决 Ajax 独特的性能问题。本文讨论如何使用工具集在 Ajax 应用程序中寻找和纠正性能问题。</p></blockquote>

<p>性能是促使开发人 员用 Ajax 改进应用程序的主要因素之一。Ajax 可以与服务器进行通信而不必请求完整的页面，因此可以改进响应时间。通过减少响应时间，Ajax 可以提供更好的用户体验。但是，分析和改进 Ajax 应用程序需要一套与传统 Web 应用程序不同的工具。本文讨论这些工具并解释如何使用它们寻找和纠正性能问题。</p>

<p>| <img src="http://www.ibm.com/i/c.gif" alt="" /> |</p>

<p>| <strong>常用的缩写词</strong></p>

<ul>
<li><strong>CSS</strong>：Cascading Style Sheets</li>
<li><strong>HTML</strong>：Hypertext Markup Language</li>
<li><strong>XML</strong>：Extensible Markup Language</li>
<li><p><strong>HTTP</strong>：Hypertext Transfer Protocol</p>

<p>|</p></li>
</ul>


<p>|</p>

<p>Ajax 应用程序的性能取决于 Web 应用程序的几个方面：</p>

<ul>
<li>服务器响应时间</li>
<li>网络传输时间</li>
<li>客户机 JavaScript 的处理时间</li>
</ul>


<p>在 传统的 Web 应用程序开发中，服务器响应时间是性能分析的主要重点。大多数性能分析度量应用服务器是否能够快速处理请求、执行必需的应用程序逻辑和生成响应。在 Ajax 应用程序开发中，这仍然是应用程序性能的一个重要方面，但是开发人员对这个方面的了解已经很深入了，所以本文主要关注性能的其他方面。</p>

<p>| <img src="http://www.ibm.com/i/c.gif" alt="" /> |</p>

<p>| <strong>developerWorks Ajax 参考资料中心</strong><br/>
  <a href="http://www.ibm.com/developerworks/cn/ajax/">Ajax 参考资料中心</a> 是一站式站点，包含关于开发 Ajax 应用程序的免费工具、代码和信息。 <a href="http://www.ibm.com/developerworks/forums/dw_forum.jsp?forum=965&amp;cat=11">active Ajax community forum</a> 由 Ajax 专家 Jack Herrington 主持，您可以在这里向其他开发人员寻求帮助。 |</p>

<p>|</p>

<p>工具</p>

<p>为了了解 Web 应用程序的哪些方面需要改进，必须适当地分析应用程序的组件。本文讨论如何使用 Firefox 的 Firebug 扩展和 YSlow 插件分析 Web 应用程序。安装这些工具之后，连接正在开发的站点并单击 Firefox 状态栏中的 <strong>YSlow</strong>。这会在 Firebug 中打开 YSlow 界面。现在单击 <strong>Performance</strong> 按钮。YSlow 对应用程序进行分析，并提供关于应用程序网络传输时间的不同部分的报告，见图 1。</p>

<p><strong>图 1. YSlow 报告</strong><br/>
  <img src="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/yslow.jpg" alt="YSlow 报告" /></p>

<p>网络传输时间</p>

<p>在大多数 Web 应用程序中，网络传输时间是主要的瓶颈。可以通过 YSlow 报告分析网络传输的不同方面，了解如何减少传输时间。</p>

<p>减少 HTTP 请求</p>

<p>每个 HTTP 请求都需要花一些时间发送到服务器并接收响应。即使响应很小，仍然需要基本的往返时间，这称为<em>延迟</em>。YSlow 根据发出的 HTTP 请求数量进行评级。大量的请求会导致装载速度显著降低。可以简化页面，减少需要装载的组件，从而减少 HTTP 请求。可以通过使用 CSS sprites 减少图像请求。获得一些可以生成 CSS sprites 的工具（参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#resources">参考资料</a> 一节）。为了减少脚本和 CSS 请求，可以以内联方式把它们包含在页面中，或者把多个脚本或 CSS 文件组合在一起。</p>

<p>可以提供指定了未来日期的 HTTP 缓存过期头，这会让浏览器对组件进行缓存，因此可以减少 HTTP 请求。当用户在页面之间导航，或者返回您的站点时，可以缓存组件，不需要在每次访问站点时都下载它。如果提供了适当的过期头，代理也可以缓存经常装载的内 容。过期头像下面这样：</p>

<p>|
Expires: Wed, 10 Mar 2009 10:00:00 GMT<br/>
|</p>

<p>请记住，如果把过期日期设置为很长时间以后，那么即使已经修改了内容，浏览器仍然会使用缓存的内容。把过期日期设置为一天以后可能比较合适。还可以通过修改文件名使文件名包含版本信息，因此在发布新版本时，就会请求新的 URL，这会让浏览器发出新的请求。可以用 <code>ExpiresDefault</code> 指令配置 Apache，从而添加过期头：</p>

<p>|
ExpiresDefault &ldquo;access plus 10 years&#8221;<br/>
  |</p>

<p>还可以通过 YSlow 检查页面的总下载大小（单击 <strong>Stats</strong> 按钮）。YSlow 会显示首次访问（没有缓存）时的页面大小和后续页面访问（可以使用缓存）时的页面大小。</p>

<p>替代的 DNS 查询</p>

<p>HTTP 请求可能涉及多次服务器往返。如果资源使用多个主机或域名，浏览器可能需要多次执行 Domain Name System（DNS）查询。如果必须查询多个名称，YSlow 会发出警告。但是一定要注意，多个 DNS 名称实际上也可能提高性能。大多数浏览器只允许每个主机名有两个连接。但是，通过使用多个主机名，可以建立更多的连接，因此可以进行更多的并发下载。</p>

<p>| <img src="http://www.ibm.com/i/c.gif" alt="" /> |</p>

<p>| 根据 Wikipedia 上的说法，<em>缩减（minify）</em> 过程就是从源代码中删除所有不必要的字符，但是不改变功能。这些不必要的字符通常包括空格字符、换行字符、注释和块分界符。这些字符用来提高代码的可读性，但是对执行代码而言并不是必要的。 |</p>

<p>|</p>

<p>减少组件传输的大小</p>

<p>除了减少 HTTP 请求数量之外，减少请求的组件的大小也对性能有好处。可以应用技术手段压缩某些格式。YSlow 会提示哪些技术可以有效地减少响应大小。</p>

<p>通 过消除不必要的空格和注释，可以缩减 JavaScript 代码、CSS 和 HTML。通过改变变量名，可以进一步压缩 JavaScript 代码。Packer 和 YUI 压缩器是有效的 JavaScript 压缩工具，YUI 压缩器也支持对 CSS 进行压缩。还可以用 JavaScript CompressorRater 比较压缩效果（参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#resources">参考资料</a> 一节）。</p>

<p>对 于基于文本的资源，最有效的压缩方法是启用 gzip（GNU zip 的缩写）。通过使用 gzip，一般情况下可以把内容大小减少大约 70%。不要对已经压缩的资源使用 gzip，比如图像和视频。适合使用 gzip 的资源包括 CSS、HTML、JavaScript 代码、XML 和 JavaScript Serialized Object Notation（JSON）。Apache 1.3 通过 <code>mod_gzip</code> 支持 gzip，Apache 2.0 使用 <code>mod_deflate</code> 。</p>

<p>通过减少资源大小来减小 HTTP 响应是很重要的，但是减小 HTTP 请求也很重要。对于许多因特网用户来说，上传速度比下载速度慢得多，所以性能对请求的大小更敏感。大的 URL、大量提交数据和过多的头都会增加请求的大小。在 Firebug 中，可以在 <strong>Net</strong> 选项卡上查看请求，见图 2。可以展开每个请求，查看请求头。不必要地增大请求头的常见原因之一是大的 cookie。cookie 包含在每个请求的头中，因此大的 cookie 会显著增加开销。</p>

<p><strong>图 2. Firebug Net 面板</strong><br/>
  <img src="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/firebug-net.jpg" alt="Firebug Net 面板" /></p>

<p>Java™ 2 Platform, Enterprise Edition（J2EE）应用程序可以通过一个简单的过滤器 Resource Accelerate 应用这些性能改进技术（缓存过期日期、gzip 和 JavaScript 压缩）。还可以使用 JavaServer Pages（JSP）标记库 pack:tag 对资源进行压缩。还可以选用其他技术，更多信息参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#resources">参考资料</a> 一节。</p>

<p>改进网络传输性能的其他技术</p>

<p>YSlow 建议的另一种改进技术是使用内容交付网络（CDN）。CDN 提供一个分布式服务器网络，内容放在比较接近最终用户的服务器上，从而改进响应时间。</p>

<p>通 过适当地调整 CSS 和脚本的次序，也可以加快显示 Web 页面的速度。YSlow 会分析 CSS 和脚本声明的位置，并提出改进次序的建议。建议把 CSS 声明放在页面顶部，这样就可以马上使用 CSS 显示页面。把脚本放在页面底部，这样就可以在装载 JavaScript 代码进行交互之前显示页面。</p>

<p>JavaScript 处理时间</p>

<p>服 务器成功地生成 Web 页面并把页面传输给浏览器之后，Ajax 应用程序通常依靠 JavaScript 代码与用户进行交互。大多数用户愿意花一点儿时间等待页面完全下载，但是高品质的交互依赖于页面的迅速反应，所以对页面上各种组件的快速响应是实现良好用 户体验的最重要的方面。另外，在等待下载资源时，浏览器常常仍然有响应能力，但是如果连续执行 JavaScript 代码，有可能完全锁住浏览器。</p>

<p>Firebug 附带一个分析工具。进入 <strong>Console</strong> 选项卡并单击 <strong>Profile</strong>， 就可以启动这个分析工具。它可以帮助了解 Web 应用程序的哪些部分大量使用了 JavaScript 代码。如果重复执行相同的操作，这个工具会产生更准确的结果。例如，如果在装载页面时执行大量 JavaScript 代码，那么可以多次装载页面。如果有 JavaScript 鼠标事件处理函数，那么可以把鼠标在页面上移动一段时间，让这个工具收集足够的信息。完成操作之后，单击 <strong>Profile</strong> 按钮再次显示分析结果，见图 3。</p>

<p><strong>图 3. Firebug 分析结果</strong><br/>
  <img src="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/firebug-profile.jpg" alt="Firebug 分析结果" /></p>

<p>分 析结果列出在分析期间发生的所有函数调用。每个条目显示调用函数的次数和关于函数调用的处理时间的统计数据。Time 列表示等待这个函数返回所花费的总时间量，Own Time 列表示等待这个函数返回所花费的总时间量减去这个函数等待它发出的调用返回的时间。Own time 列通常是最重要的数据，因为它们指出哪些地方发生了耗时很长的处理，而且 Percent 列中的值基于这些数据。在默认情况下，Firebug 按照 Percent 列排序，最高的值放在最上面。耗时最长的调用放在最上面，您可以集中精力改进这些函数的性能。在使用 Firebug 时，很容易访问函数的源代码；只需单击列表中的条目，就会转到那个函数。</p>

<p>在评估 JavaScript 函数的性能时，还要注意调用函数的次数。函数本身可能并不慢（可以查看函数的平均处理时间），但是调用得太频繁了。有时候，不必要地频繁调用一个函数会造成性能问题。例如， <code>onmousemove</code> 等鼠标事件处理函数常常会产生大量调用。</p>

<p>如果发现某个函数花费的处理时间很长，就需要检查 JavaScript 代码，寻找可能存在的问题。 <a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#table1">表 1</a> 列出一些缓慢的 JavaScript 操作。关于性能基准的更多信息，参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-aj-perform/?ca=drs-tp2008#resources">参考资料</a> 一节。</p>

<p><strong>表 1. 缓慢的 JavaScript 操作</strong></p>

<table>
<thead>
<tr>
<th></th>
<th> 操作 </th>
<th> 说明 </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> DOM 访问 </td>
<td> 与 DOM 的交互常常比普通 JavaScript 代码慢。与 DOM 的交互常常是无法回避的，但是应该尽可能减少。例如，用字符串动态地创建 HTML 并设置 innerHTML 常常比用 DOM 方法创建 HTML 要快。 |</td>
</tr>
<tr>
<td></td>
<td> eval </td>
<td> 应该尽可能避免使用 <code>eval</code> 方法，因为脚本运算的开销很大。 |</td>
</tr>
<tr>
<td></td>
<td> with </td>
<td> 使用 <code>with</code> 语句创建额外的范围对象，这会减慢变量访问并造成二义性。 |</td>
</tr>
<tr>
<td></td>
<td> for-in 循环 </td>
<td> 使用传统的 <code>for (var i=0; i&lt;array.length;i++)</code> 循环遍历数组，而不是使用 for-in 循环。不幸的是，大多数 JavaScript 环境中的 for-in 循环实现很慢。 |</td>
</tr>
</tbody>
</table>


<p>其他浏览器</p>

<p>带 Firebug 和 YSlow 的 Firefox 是分析性能的最佳选择。对于 Mac OS X 上的 Safari，还可以使用 Web Inspector 分析 HTTP 请求。对于 JavaScript 性能分析，可以使用手工技术评估某些函数的性能。手工评估函数的方法是，用 <code>Date</code> 函数度量执行时间，见清单 1：</p>

<p><strong>清单 1. 手工计时</strong></p>

<p>|</p>

<p>function myFunctionToTest() {<br/>
var start = new Date().getTime();<br/>
&hellip; // body of the function<br/>
var totalTime = new Date().getTime() &ndash; start;<br/>
}</p>

<p>|</p>

<p>可能影响性能的一个重要问题是 Windows® Internet Explorer® 糟糕的内存管理。随着创建更多的对象和属性，没有应用补丁的 Internet Explorer 6 和更早版本会逐渐变慢。一般来说，如果创建的对象超过 5000 个，旧版本的 Internet Explorer 就非常慢了。</p>

<p>结束语</p>

<p>通 过使用 Firebug 和 YSlow，可以彻底地分析 Web 应用程序并进行合理的修改来提升性能。YSlow 提供的详细信息有助于减少网络传输时间。Firebug 提供详细的 JavaScript 分析，有助于识别需要改进的代码。这些工具可以帮助开发人员开发性能更好的 Web 应用程序，提供更好的用户体验。</p>

<p>  |</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">ChandleWEi</span></span>

      








  


<time datetime="2008-05-20T00:00:00+08:00" pubdate data-updated="true">May 20<span>th</span>, 2008</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>Linux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ChandleWEi.github.io/blog/2008/05/20/Ajax_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90_ZZ/" data-via="ChandleWEi" data-counturl="http://ChandleWEi.github.io/blog/2008/05/20/Ajax_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90_ZZ/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2008/05/19/curl%E6%89%8B%E5%86%8C/" title="Previous Post: curl手册">&laquo; curl手册</a>
      
      
        <a class="basic-alignment right" href="/blog/2008/05/27/%E5%8D%81%E4%B8%AA%E4%B8%8D%E5%8F%AF%E6%88%96%E7%BC%BA%E7%9A%84_ruby_gems/" title="Next Post: 十个不可或缺的_ruby_gems">十个不可或缺的_ruby_gems &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/02/17/go-wait-example/">Go Wait Example</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/17/go-wait-example/">Go Wait Example</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/11/first-touch/">First Touch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/01/%5B%E8%BD%AC%EF%BC%BDiphone_openvpn/">[转］iphone_openvpn</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/05/24/avplayer/">Avplayer</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Chandler Wei -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
